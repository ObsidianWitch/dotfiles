#!/usr/bin/env python3

import sys, os

if 'bpy' not in sys.modules:
    assert len(sys.argv) == 2
    os.execlp('blender', 'blender', '--background', sys.argv[1], '--python', sys.argv[0])
else:
    import tempfile, contextlib
    import bpy

    with tempfile.TemporaryDirectory() as dirpath:
        filepath = f'{dirpath}/scene.usda'
        with contextlib.redirect_stdout(None): # hide operator output
            bpy.ops.wm.usd_export(filepath=filepath)

        with open(filepath) as fp:
            print(fp.read())
