#!/bin/bash

set -o errexit -o nounset -o xtrace

setfacl -m "$1":r-x -- "$XDG_RUNTIME_DIR"
setfacl -m "$1":rwx -- "$XDG_RUNTIME_DIR/wayland-1"
setfacl -m "$1":rw- -- "$XDG_RUNTIME_DIR/wayland-1.lock"
xhost +si:localuser:"$1"

su --login --whitelist-environment='DISPLAY,WAYLAND_DISPLAY,XDG_RUNTIME_DIR' "$1" "${@:2}"

xhost -si:localuser:"$1"
setfacl --remove-all "$XDG_RUNTIME_DIR/"{'','wayland-1','wayland-1.lock'}
