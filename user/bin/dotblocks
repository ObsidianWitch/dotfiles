#!/bin/bash

set -o errexit -o nounset

block_pa_in() {
    case "${button:-}" in
        1) pamixer --default-source --toggle-mute;;
        3) pavucontrol;;
        4) pamixer --default-source --increase 5;;
        5) pamixer --default-source --decrease 5;;
    esac
    echo "$(pamixer --default-source --get-mute --get-volume \
            | sed -e 's/false//' -e 's/true//')%"
}

block_pa_out() {
    case "${button:-}" in
        1) pamixer --toggle-mute;;
        3) pavucontrol;;
        4) pamixer --increase 5;;
        5) pamixer --decrease 5;;
    esac
    echo "$(pamixer --get-mute --get-volume \
            | sed -e 's/false//' -e 's/true//')%"
}

block_brightness() {
    case "${button:-}" in
        4) xbacklight -steps 1 +5;;
        5) xbacklight -steps 1 -5;;
    esac
    echo " $(xbacklight | xargs printf '%.0f%%')"
}

block_power() {
    local plugged capacity
    plugged=$(< '/sys/class/power_supply/ADP1/online')
    capacity=$(< '/sys/class/power_supply/BAT0/capacity')
    if [[ "$plugged" -eq 1 ]]; then
        local icon=''
    else
        local icon=''
    fi
    echo "$icon $capacity%"

    # low power: set urgent (https://github.com/vivien/i3blocks#command)
    if [[ "$plugged" -eq 0 && "$capacity" -le 10 ]]; then
        exit 33
    fi
}

"block_$1"
