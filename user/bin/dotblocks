#!/bin/bash

set -o errexit -o nounset

dotpa_in() {
    case "${button:-}" in
        1) pamixer --default-source --toggle-mute;;
        3) pavucontrol;;
        4) pamixer --default-source --increase 5;;
        5) pamixer --default-source --decrease 5;;
    esac
    echo "$(pamixer --default-source --get-mute --get-volume \
            | sed -e 's/false//' -e 's/true//')%"
}

dotpa_out() {
    case "${button:-}" in
        1) pamixer --toggle-mute;;
        3) pavucontrol;;
        4) pamixer --increase 5;;
        5) pamixer --decrease 5;;
    esac
    echo "$(pamixer --get-mute --get-volume \
            | sed -e 's/false//' -e 's/true//')%"
}

dotbrightness() {
    case "${button:-}" in
        4) xbacklight -steps 1 +5;;
        5) xbacklight -steps 1 -5;;
    esac
    echo " $(xbacklight | xargs printf '%.0f%%')"
}

dotpower() {
    local devices='/org/freedesktop/UPower/devices'
    local icon=''
    if upower -i "$devices/line_power_ADP1" | grep -q 'online: *yes'; then
        local icon=''
    fi
    echo "$icon $(upower -i "$devices/battery_BAT0" \
        | awk '/percentage/ { print $2 }')"
}

if [[ "$1" == "pa_in" ]]; then
    dotpa_in
elif [[ "$1" == "pa_out" ]]; then
    dotpa_out
elif [[ "$1" == "brightness" ]]; then
    dotbrightness
elif [[ "$1" == "power" ]]; then
    dotpower
else
    exit 1
fi
