#!/usr/bin/env python3

import pathlib, shutil, argparse

def sort_tags(paths):
    for old_path in paths:
        old_path = pathlib.Path(old_path)
        if old_path.is_dir(): continue

        title = old_path.name.removesuffix(''.join(old_path.suffixes))

        tags = next((s for s in old_path.suffixes if s.startswith('.+')), '')
        tags = tags[:2] + '+'.join(sorted(tags[2:].split('+')))

        suffixes = list(s for s in old_path.suffixes if not s.startswith('.+'))
        suffixes = ''.join(suffixes)

        new_path = old_path.with_name(f'{title}{tags}{suffixes}')

        if old_path == new_path: continue
        print(f'* {old_path} -> {new_path}')
        shutil.move(old_path, new_path)

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='sort tags')
    parser.add_argument('paths', nargs='+')
    args = parser.parse_args()
    sort_tags(args.paths)
