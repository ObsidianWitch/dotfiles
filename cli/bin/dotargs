#!/bin/bash

# dotargs - handle cli arguments
#
# Synopsis
#    eval "$(dotargs args...)"
#
# Description
#   Convert passed arguments to the following bash variables:
#   * posargs: indexed array of positional arguments
#   * optargs: indexed array of optional arguments
#   * kwargs: associative array of optional arguments
#   options syntax: -k, -k=value, --key, --key=value
#
# Examples:
#   $ eval "$(dotargs a -l=orem b -i c --dolor=sit d --amet e)"
#   $ declare -p posargs optargs kwargs
#   declare -a posargs=([0]="a" [1]="b" [2]="c" [3]="d" [4]="e")
#   declare -a optargs=([0]="-l=orem" [1]="-i" [2]="--dolor=sit" [3]="--amet")
#   declare -A kwargs=([--dolor]="sit" [-l]="orem" [-i]="-i" [--amet]="--amet" )
dotargs() {
    declare -a posargs
    declare -a optargs
    declare -A kwargs
    local arg; for arg in "$@"; do
        if [[ "$arg" == -* ]]; then
            optargs+=( "$arg" )
            local key value
            IFS='=' read -r key value <<< "$arg"
            kwargs["$key"]="${value:-$key}"
        else
            posargs+=( "$arg" )
        fi
    done

    declare -p posargs optargs kwargs
}

dotargs "$@"
