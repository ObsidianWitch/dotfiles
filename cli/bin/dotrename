#!/bin/bash

# dotrename - rename files with their sha1sum to provide a (hopefully) unique
# filename and preseve file extensions.
#
# Synopsis
#   dotrename file...
dotrename() {
    local filepath dirpath hash ext
    for filepath in "$@"; do
        if [[ -d $filepath ]]; then continue; fi
        dirpath=$(dirname "$filepath")
        hash=$(sha1sum "$filepath" | cut -d' ' -f1)
        ext=$(grep --only-matching --regexp='\..*' <<< "$filepath")
        mv "$filepath" "$dirpath/${hash}${ext}"
    done
}

dotrename "$@"
