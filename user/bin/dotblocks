#!/bin/bash

set -o errexit -o nounset

block_pa_in() {
    case "${button:-}" in
        1) pamixer --default-source --toggle-mute;;
        3) pavucontrol;;
        4) pamixer --default-source --increase 5;;
        5) pamixer --default-source --decrease 5;;
    esac
    echo "$(pamixer --default-source --get-mute --get-volume \
            | sed -e 's/false//' -e 's/true//')%"
}

block_pa_out() {
    case "${button:-}" in
        1) pamixer --toggle-mute;;
        3) pavucontrol;;
        4) pamixer --increase 5;;
        5) pamixer --decrease 5;;
    esac
    echo "$(pamixer --get-mute --get-volume \
            | sed -e 's/false//' -e 's/true//')%"
}

block_brightness() {
    case "${button:-}" in
        4) xbacklight -steps 1 +5;;
        5) xbacklight -steps 1 -5;;
    esac
    echo " $(xbacklight | xargs printf '%.0f%%')"
}

block_power() {
    local devices='/org/freedesktop/UPower/devices'
    local icon=''
    if upower -i "$devices/line_power_ADP1" | grep -q 'online: *yes'; then
        local icon=''
    fi
    echo "$icon $(upower -i "$devices/battery_BAT0" \
        | awk '/percentage/ { print $2 }')"
}

block_ram() {
    echo -n ' '
    local ram="$(free -h | awk 'NR == 2 {print $7 "B"}')"
    local swap="$(free -h | awk 'NR == 3 {print $4 "B"}')"
    echo "R:$ram S:$swap"
}

case ${1:-} in
    pa_in) block_pa_in;;
    pa_out) block_pa_out;;
    brightness) block_brightness;;
    power) block_power;;
    ram) block_ram;;
    *) exit 1;;
esac
