#!/bin/bash

# Synopsis
#   doterr [message] [exit_status = 1]
#   cmd || doterr [message] [exit_status = 1]
#   cmd && doterr [message] [exit_status = 1]
# Description
#   Outputs an error message and returns with a status code. It should be used
#   in conjunction with `set -o errexit` in order to make scripts exit early on
#   error.
# Examples
#   [[ "$#" -ge 2 ]] || doterr 'missing file operand'
#   -> ?1 missing file operand
#
#   [[ "$#" -lt 2 ]] && doterr 'missing file operand'
#   -> ?1 missing file operand
#
#   useradd root || doterr 'custom error message' "$?"
#   -> ?9 custom error message
doterr() {
    local status="${2:-1}"
    echo "?$status ${1:-}" 1>&2
    return "$status"
}

doterr "$@"
